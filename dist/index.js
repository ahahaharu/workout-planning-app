"use strict";class e{constructor(e,t,r,s,o,i){this.id=e,this.name=t,this.password=r,this.email=s,this.currentWeight=o,this.weightHistory=[{date:new Date,weight:o}],this.height=i,this.workoutsHistory=[],this.workoutPlans=[]}updateWeight(e){this.currentWeight=e,this.weightHistory.push({date:new Date,weight:e})}addWorkoutPlan(e){this.workoutPlans.push(e)}getWorkoutPlans(){return this.workoutPlans}addWorkout(e){this.workoutsHistory.push(e)}getWorkoutHistory(){return this.workoutsHistory}updateProfile(e,t,r,s){this.name=e||this.name,this.password=t||this.password,this.email=r||this.email,this.height=s||this.height}}class t{constructor(e){this.storageManager=e,this.users=this.storageManager.getUsers()||[],this.currentUser=null,this._deserializeUsers()}_deserializeUsers(){this.users=this.users.map((t=>{const r=new e(t.id,t.name,t.password,t.email,t.currentWeight,t.height);return t.weightHistory&&t.weightHistory.length&&(r.weightHistory=t.weightHistory.map((e=>({date:new Date(e.date),weight:e.weight})))),r}))}_saveUsers(){this.storageManager.saveUsers(this.users)}getUserById(e){const t=this.users.find((t=>t.id===e));if(!t)throw new Error(`Пользователь с ID ${e} не найден`);return t}generateUserId(){return this.users.length?Math.max(...this.users.map((e=>e.id)))+1:1}registerUser(t,r,s,o,i){if(this.users.some((e=>e.email===s)))throw new Error("Пользователь с таким email уже существует");const a=this.generateUserId(),n=new e(a,t,r,s,o,i);return this.users.push(n),this._saveUsers(),n}loginUser(e,t){const r=this.users.find((t=>t.email===e));if(!r)throw new Error("Пользователя с таким email не существует");if(r.password!==t)throw new Error("Неверный пароль");return this.currentUser=r,r}updateUserWeight(e){this.validateCurrentUser(),this.currentUser.updateWeight(e),this._saveUsers()}updateUserProfile(e,t,r,s){this.validateCurrentUser(),this.currentUser.updateProfile(e,t,r,s),this._saveUsers()}getCurrentUser(){return this.currentUser}validateCurrentUser(){if(!this.currentUser)throw new Error("Пользователь не авторизован")}getAllUsers(){return this.users}}class r{constructor(e,t,r,s,o,i){this.id=e,this.name=t,this.image=r,this.description=s||"",this.mediaUrl=o,this.type=i,this.notes=[]}updateExercise(e,t,r){this.name=e||this.name,this.description=t||this.description,this.mediaUrl=r||this.mediaUrl}addNote(e){this.notes.push(e)}}class s{constructor(e,t,r=null){this.duration=e,this.distance=t,this.caloriesBurned=r}calculatePace(){return this.distance&&0!==this.distance?this.duration/this.distance:0}calculateSpeed(){return this.duration&&0!==this.duration?this.distance/this.duration*60:0}}class o extends r{constructor(e,t,r,s,o,i,a){super(e,t,r,s,o,i),this.cardioType=a,this.sessions=[]}addSession(e,t,r=null){this.sessions.push(new s(e,t,r))}removeSession(e){this.sessions.splice(e,1)}getSessions(){return this.sessions}updateSession(e,t,r,s){this.sessions[e].duration=t||this.sessions[e].duration,this.sessions[e].distance=r||this.sessions[e].distance,this.sessions[e].caloriesBurned=s||this.sessions[e].caloriesBurned}getTotalDuration(){return this.sessions.reduce(((e,t)=>e+(t.duration||0)),0)}getTotalDistance(){return this.sessions.reduce(((e,t)=>e+(t.distance||0)),0)}getTotalCalories(){return this.sessions.reduce(((e,t)=>e+(t.caloriesBurned||0)),0)}getAveragePace(){return 0===this.sessions.length?0:this.sessions.reduce(((e,t)=>e+t.calculatePace()),0)/this.sessions.length}getBestPace(){return 0===this.sessions.length?0:Math.min(...this.sessions.map((e=>e.calculatePace())).filter((e=>e>0)))}getAverageSpeed(){return 0===this.sessions.length?0:this.sessions.reduce(((e,t)=>e+t.calculateSpeed()),0)/this.sessions.length}getBestSpeed(){return 0===this.sessions.length?0:Math.max(...this.sessions.map((e=>e.calculateSpeed())))}}const i={STRENGTH:"Strength",CARDIO:"Cardio",ENDURANCE:"Endurance"};class a{constructor(e,t=null){this.duration=e,this.difficulty=t}calculateIntensity(){return this.difficulty&&this.duration?this.difficulty*this.duration/60:0}}class n extends r{constructor(e,t,r,s,o,i,a){super(e,t,r,s,o,i),this.targetMuscle=a,this.sessions=[]}addSession(e,t=null){this.sessions.push(new a(e,t))}removeSession(e){this.sessions.splice(e,1)}getSessions(){return this.sessions}updateSession(e,t,r){this.sessions[e].duration=t||this.sessions[e].duration,this.sessions[e].difficulty=r||this.sessions[e].difficulty}getTotalDuration(){return this.sessions.reduce(((e,t)=>e+(t.duration||0)),0)}getAverageDuration(){return 0===this.sessions.length?0:this.getTotalDuration()/this.sessions.length}getMaxDuration(){return 0===this.sessions.length?0:Math.max(...this.sessions.map((e=>e.duration)))}getAverageDifficulty(){return 0===this.sessions.length?0:this.sessions.reduce(((e,t)=>e+(t.difficulty||0)),0)/this.sessions.length}getTotalIntensity(){return this.sessions.reduce(((e,t)=>e+t.calculateIntensity()),0)}getAverageIntensity(){return 0===this.sessions.length?0:this.getTotalIntensity()/this.sessions.length}}class c{constructor(e,t=null){this.reps=e,this.weight=t}calculateOneRepMax(){return this.weight&&this.reps?Math.round(this.weight*(1+this.reps/30)):0}}class u extends r{constructor(e,t,r,s,o,i,a,n){super(e,t,r,s,o,i),this.bodyPart=a,this.sets=n||[]}addSet(e,t){this.sets.push(new c(e,t))}removeSet(e){this.sets.splice(e,1)}getSets(){return this.sets}updateSet(e,t,r){this.sets[e].reps=t||this.sets[e].reps,this.sets[e].weight=r||this.sets[e].weight}getAverageOneRepMax(){return this.sets.reduce(((e,t)=>e+t.calculateOneRepMax()),0)/this.sets.length}getBestOneRepMax(){return Math.max(...this.sets.map((e=>e.calculateOneRepMax())))}getMaxWeight(){return Math.max(...this.sets.map((e=>e.weight)))}getTotalWeight(){return this.sets.reduce(((e,t)=>e+(t.weight||0)*t.reps),0)}}class h{static createExercise(e,t,r,s,o,a,n){switch(e){case i.STRENGTH:return this.createStrengthExercise(t,r,s,o,a,n);case i.CARDIO:return this.createCardioExercise(t,r,s,o,a,n);case i.ENDURANCE:return this.createEnduranceExercise(t,r,s,o,a,n);default:throw new Error(`Неподдерживаемый тип упражнения: ${e}`)}}static createStrengthExercise(e,t,r,s,o,a,n=[]){return new u(e,t,r,s,o,i.STRENGTH,a,n)}static createCardioExercise(e,t,r,s,a,n){return new o(e,t,r,s,a,i.CARDIO,n)}static createEnduranceExercise(e,t,r,s,o,a){return new n(e,t,r,s,o,i.ENDURANCE,a)}}class g{constructor(e){this.storageManager=e,this.exercises=this.storageManager.getExercises()||[],this._deserializeExercises()}_deserializeExercises(){this.exercises=this.exercises.map((e=>{let t;return e.type===i.STRENGTH?(t=new u(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.bodyPart,[]),e.sets&&e.sets.length&&e.sets.forEach((e=>{t.addSet(e.reps,e.weight)}))):e.type===i.CARDIO?(t=new o(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.cardioType),e.sessions&&e.sessions.length&&e.sessions.forEach((e=>{t.addSession(e.duration,e.distance,e.caloriesBurned)}))):e.type===i.ENDURANCE&&(t=new n(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.targetMuscle),e.sessions&&e.sessions.length&&e.sessions.forEach((e=>{t.addSession(e.duration,e.difficulty)}))),e.notes&&e.notes.length&&e.notes.forEach((e=>{t.addNote(e)})),t}))}_saveExercises(){this.storageManager.saveExercises(this.exercises)}generateExerciseId(){return this.exercises.length?Math.max(...this.exercises.map((e=>e.id)))+1:0}createStrengthExercise(e,t,r,s,o){const i=this.generateExerciseId(),a=h.createStrengthExercise(i,e,t,r,s,o);return this.exercises.push(a),this._saveExercises(),a}createCardioExercise(e,t,r,s,o){const i=this.generateExerciseId(),a=h.createCardioExercise(i,e,t,r,s,o);return this.exercises.push(a),this._saveExercises(),a}createEnduranceExercise(e,t,r,s,o){const i=this.generateExerciseId(),a=h.createEnduranceExercise(i,e,t,r,s,o);return this.exercises.push(a),this._saveExercises(),a}createGenericExercise(e,t,r,s,o,i){const a=this.generateExerciseId(),n=h.createExercise(e,a,t,r,s,o,i);return this.exercises.push(n),this._saveExercises(),n}removeExercise(e){this.exercises=this.exercises.filter((t=>t.id!==e)),this._saveExercises()}getExerciseById(e){return this.exercises.find((t=>t.id===e))}getAllExercises(){return this.exercises}}class l{copyExercise(e){throw new Error("Method must be implemented by concrete strategy")}addTrackingData(e,t){throw new Error("Method must be implemented by concrete strategy")}updateTrackingData(e,t,r){throw new Error("Method must be implemented by concrete strategy")}getStatistics(e){throw new Error("Method must be implemented by concrete strategy")}calculateProgress(e,t){throw new Error("Method must be implemented by concrete strategy")}hasChanges(e,t){throw new Error("Method must be implemented by concrete strategy")}updatePlanData(e,t){throw new Error("Method must be implemented by concrete strategy")}}class d extends l{copyExercise(e){const t=new u(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.bodyPart,[]),r=e.getSets?e.getSets():Array.isArray(e.sets)?e.sets:[];return r&&r.length&&r.forEach((e=>{e&&"object"==typeof e&&"reps"in e&&"weight"in e&&t.addSet(e.reps,e.weight)})),t}addTrackingData(e,t){if(!t.reps||!t.weight)throw new Error("Reps and weight required for strength exercise");e.addSet(t.reps,t.weight)}updateTrackingData(e,t,r){if(!e.sets[t])throw new Error(`Set at index ${t} not found`);e.updateSet(t,r.reps,r.weight)}getStatistics(e){return{totalWeight:e.getTotalWeight(),bestOneRepMax:e.getBestOneRepMax(),maxWeight:e.getMaxWeight()}}calculateProgress(e,t){return{bestOneReMaxProgress:t.getBestOneRepMax()-e.getBestOneRepMax(),maxWeightProgress:t.getMaxWeight()-e.getMaxWeight(),totalWeightProgress:t.getTotalWeight()-e.getTotalWeight()}}hasChanges(e,t){if(e.sets.length!==t.sets.length)return!0;for(let r=0;r<e.sets.length;r++)if(e.sets[r].reps!==t.sets[r].reps||e.sets[r].weight!==t.sets[r].weight)return!0;return!1}updatePlanData(e,t){t.sets=[];for(const r of e.sets)t.addSet(r.reps,r.weight)}}class w extends l{copyExercise(e){const t=new o(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.cardioType),r=e.getSessions?e.getSessions():Array.isArray(e.sessions)?e.sessions:[];return r&&r.length&&r.forEach((e=>{e&&"object"==typeof e&&t.addSession(e.duration,e.distance,e.caloriesBurned)})),t}addTrackingData(e,t){if(!t.duration||!t.distance)throw new Error("Duration and distance required for cardio exercise");e.addSession(t.duration,t.distance,t.caloriesBurned)}updateTrackingData(e,t,r){if(!e.sessions[t])throw new Error(`Session at index ${t} not found`);e.updateSession(t,r.duration,r.distance,r.caloriesBurned)}getStatistics(e){return{totalDistance:e.getTotalDistance(),totalDuration:e.getTotalDuration(),bestPace:e.getBestPace(),averagePace:e.getAveragePace(),bestSpeed:e.getBestSpeed(),averageSpeed:e.getAverageSpeed(),totalCalories:e.getTotalCalories()}}calculateProgress(e,t){return{totalDistanceProgress:t.getTotalDistance()-e.getTotalDistance(),totalDurationProgress:t.getTotalDuration()-e.getTotalDuration(),bestPaceProgress:t.getBestPace()-e.getBestPace(),bestSpeedProgress:t.getBestSpeed()-e.getBestSpeed(),totalCaloriesProgress:t.getTotalCalories()-e.getTotalCalories()}}hasChanges(e,t){if(e.sessions.length!==t.sessions.length)return!0;for(let r=0;r<e.sessions.length;r++)if(e.sessions[r].duration!==t.sessions[r].duration||e.sessions[r].distance!==t.sessions[r].distance||e.sessions[r].caloriesBurned!==t.sessions[r].caloriesBurned)return!0;return!1}updatePlanData(e,t){t.sessions=[];for(const r of e.sessions)t.addSession(r.duration,r.distance,r.caloriesBurned)}}class y extends l{copyExercise(e){const t=new n(e.id,e.name,e.image,e.description,e.mediaUrl,e.type,e.targetMuscle),r=e.getSessions?e.getSessions():Array.isArray(e.sessions)?e.sessions:[];return r&&r.length&&r.forEach((e=>{e&&"object"==typeof e&&t.addSession(e.duration,e.difficulty)})),t}addTrackingData(e,t){if(!t.duration)throw new Error("Duration required for endurance exercise");e.addSession(t.duration,t.difficulty)}updateTrackingData(e,t,r){if(!e.sessions[t])throw new Error(`Session at index ${t} not found`);e.updateSession(t,r.duration,r.difficulty)}getStatistics(e){return{totalDuration:e.getTotalDuration(),maxDuration:e.getMaxDuration(),averageDifficulty:e.getAverageDifficulty(),totalIntensity:e.getTotalIntensity(),averageIntensity:e.getAverageIntensity()}}calculateProgress(e,t){return{totalDurationProgress:t.getTotalDuration()-e.getTotalDuration(),maxDurationProgress:t.getMaxDuration()-e.getMaxDuration(),averageDifficultyProgress:t.getAverageDifficulty()-e.getAverageDifficulty(),totalIntensityProgress:t.getTotalIntensity()-e.getTotalIntensity()}}hasChanges(e,t){if(e.sessions.length!==t.sessions.length)return!0;for(let r=0;r<e.sessions.length;r++)if(e.sessions[r].duration!==t.sessions[r].duration||e.sessions[r].difficulty!==t.sessions[r].difficulty)return!0;return!1}updatePlanData(e,t){t.sessions=[];for(const r of e.sessions)t.addSession(r.duration,r.difficulty)}}class k{constructor(){this.strategies={[i.STRENGTH]:new d,[i.CARDIO]:new w,[i.ENDURANCE]:new y}}getStrategy(e){const t=this.strategies[e];if(!t)throw new Error(`No strategy found for exercise type: ${e}`);return t}registerStrategy(e,t){this.strategies[e]=t}}class p{constructor(e,t,r,s,o){this.id=e,this.ownerId=t,this.name=r,this.description=s||"",this.exercises=[],this.notes=[],this.strategyFactory=new k}updateWorkoutPlan(e,t){this.name=e||this.name,this.description=t||this.description}addExercise(e){try{const t=this.strategyFactory.getStrategy(e.type).copyExercise(e);return this.exercises.push(t),t}catch(e){throw new Error(`Failed to add exercise: ${e.message}`)}}getExerciseById(e){return this.exercises.find((t=>t.id===e))}addTrackingData(e,t){const r=this.getExerciseById(e);if(!r)throw new Error(`Exercise with id ${e} not found`);return this.strategyFactory.getStrategy(r.type).addTrackingData(r,t),r}addSetToExercise(e,t,r){return this.addTrackingData(e,{reps:t,weight:r})}addSessionToExercise(e,t,r,s=null){return this.addTrackingData(e,{duration:t,distance:r,caloriesBurned:s})}addEnduranceSessionToExercise(e,t,r=null){return this.addTrackingData(e,{duration:t,difficulty:r})}updateTrackingData(e,t,r){const s=this.getExerciseById(e);if(!s)throw new Error(`Exercise with id ${e} not found`);this.strategyFactory.getStrategy(s.type).updateTrackingData(s,t,r)}updateSetInExercise(e,t,r,s){return this.updateTrackingData(e,t,{reps:r,weight:s})}updateSessionInExercise(e,t,r,s,o){return this.updateTrackingData(e,t,{duration:r,distance:s,caloriesBurned:o})}updateEnduranceSessionInExercise(e,t,r,s){return this.updateTrackingData(e,t,{duration:r,difficulty:s})}removeExercise(e){this.exercises=this.exercises.filter((t=>t.id!==e))}removeTrackingData(e,t){const r=this.getExerciseById(e);if(!r)throw new Error(`Exercise with id ${e} not found`);this.strategyFactory.getStrategy(r.type),"Strength"===r.type&&r.sets?r.sets.splice(t,1):"Cardio"!==r.type&&"Endurance"!==r.type||!r.sessions||r.sessions.splice(t,1)}removeSetFromExercise(e,t){return this.removeTrackingData(e,t)}removeSessionFromExercise(e,t){return this.removeTrackingData(e,t)}removeEnduranceSessionFromExercise(e,t){return this.removeTrackingData(e,t)}addNote(e){this.notes.push(e)}removeNote(e){this.notes.splice(e,1)}}class E{constructor(e,t){this.exerciseService=e,this.storageManager=t,this.workoutPlans=this.storageManager.getWorkoutPlans()||[],this.strategyFactory=new k,this._deserializeWorkoutPlans()}_deserializeWorkoutPlans(){this.workoutPlans=this.workoutPlans.map((e=>{const t=new p(e.id,e.ownerId,e.name,e.description);return e.notes&&e.notes.length&&e.notes.forEach((e=>{t.addNote(e)})),e.exercises&&e.exercises.length&&e.exercises.forEach((e=>{const r=this.exerciseService.getExerciseById(e.id);r&&(t.addExercise(r),e.type===i.STRENGTH&&e.sets?e.sets.forEach((r=>{t.addSetToExercise(e.id,r.reps,r.weight)})):e.type===i.CARDIO&&e.sessions?e.sessions.forEach((r=>{t.addSessionToExercise(e.id,r.duration,r.distance,r.caloriesBurned)})):e.type===i.ENDURANCE&&e.sessions&&e.sessions.forEach((r=>{t.addEnduranceSessionToExercise(e.id,r.duration,r.difficulty)})))})),t}))}_saveWorkoutPlans(){this.storageManager.saveWorkoutPlans(this.workoutPlans)}generateWorkoutPlanId(){return this.workoutPlans.length?Math.max(...this.workoutPlans.map((e=>e.id)))+1:0}createWorkoutPlan(e,t,r){const s=this.generateWorkoutPlanId(),o=new p(s,e,t,r);return this.workoutPlans.push(o),this._saveWorkoutPlans(),o}deleteWorkoutPlan(e){this.workoutPlans=this.workoutPlans.filter((t=>t.id!==e)),this._saveWorkoutPlans()}addExerciseToWorkoutPlan(e,t){const r=this.getWorkoutPlanById(e),s=this.exerciseService.getExerciseById(t);if(!r)throw new Error(`План тренировки с ID ${e} не найден`);if(!s)throw new Error(`Упражнение с ID ${t} не найдено`);return r.addExercise(s),this._saveWorkoutPlans(),r}removeExerciseFromWorkoutPlan(e,t){const r=this.getWorkoutPlanById(e);if(!r)throw new Error(`План тренировки с ID ${e} не найден`);return r.removeExercise(t),this._saveWorkoutPlans(),r}addTrackingDataToExercise(e,t,r){const s=this.getWorkoutPlanById(e);if(!s)throw new Error(`План тренировки с ID ${e} не найден`);const o=s.exercises.find((e=>e.id===t));if(!o)throw new Error(`Упражнение с ID ${t} не найдено в плане`);try{return this.strategyFactory.getStrategy(o.type).addTrackingData(o,r),this._saveWorkoutPlans(),o}catch(e){throw new Error(`Ошибка добавления данных: ${e.message}`)}}addSetToExerciseInWorkoutPlan(e,t,r,s){return this.addTrackingDataToExercise(e,t,{reps:r,weight:s})}addSessionToExerciseInWorkoutPlan(e,t,r,s,o=null){return this.addTrackingDataToExercise(e,t,{duration:r,distance:s,caloriesBurned:o})}addEnduranceSessionToExerciseInWorkoutPlan(e,t,r,s=null){return this.addTrackingDataToExercise(e,t,{duration:r,difficulty:s})}updateTrackingDataInExercise(e,t,r,s){const o=this.getWorkoutPlanById(e);if(!o)throw new Error(`План тренировки с ID ${e} не найден`);const i=o.exercises.find((e=>e.id===t));if(!i)throw new Error(`Упражнение с ID ${t} не найдено в плане`);try{return this.strategyFactory.getStrategy(i.type).updateTrackingData(i,r,s),this._saveWorkoutPlans(),i}catch(e){throw new Error(`Ошибка обновления данных: ${e.message}`)}}updateSetInExercise(e,t,r,s,o){return this.updateTrackingDataInExercise(e,t,r,{reps:s,weight:o})}updateSessionInExercise(e,t,r,s,o,i){return this.updateTrackingDataInExercise(e,t,r,{duration:s,distance:o,caloriesBurned:i})}updateEnduranceSessionInExercise(e,t,r,s,o){return this.updateTrackingDataInExercise(e,t,r,{duration:s,difficulty:o})}removeTrackingDataFromExercise(e,t,r){const s=this.getWorkoutPlanById(e);if(!s)throw new Error(`План тренировки с ID ${e} не найден`);return s.removeTrackingData(t,r),this._saveWorkoutPlans(),s}removeSetFromExercise(e,t,r){return this.removeTrackingDataFromExercise(e,t,r)}removeSessionFromExercise(e,t,r){return this.removeTrackingDataFromExercise(e,t,r)}getWorkoutPlanById(e){return this.workoutPlans.find((t=>t.id===e))}getWorkoutPlansForUser(e){return this.workoutPlans.filter((t=>t.ownerId===e))}getAllWorkoutPlans(){return this.workoutPlans}}class x{constructor(e,t,r,s=null){this.id=e,this.ownerId=t,this.date=r||new Date,this.plan=s,this.exercises=[],this.strategyFactory=new k,s&&s.exercises&&(this.exercises=s.exercises.map((e=>{try{return this.strategyFactory.getStrategy(e.type).copyExercise(e)}catch(e){return console.error(`Error copying exercise: ${e.message}`),null}})).filter((e=>null!==e)))}addExercise(e){try{const t=this.strategyFactory.getStrategy(e.type).copyExercise(e);return this.exercises.push(t),t}catch(e){throw new Error(`Failed to add exercise: ${e.message}`)}}getExerciseById(e){return this.exercises.find((t=>t.id===e))}recordTrackingData(e,t){const r=this.getExerciseById(e);if(!r)throw new Error(`Exercise with id ${e} not found`);this.strategyFactory.getStrategy(r.type).addTrackingData(r,t)}recordSet(e,t,r){return this.recordTrackingData(e,{reps:t,weight:r})}recordCardioSession(e,t,r,s=null){return this.recordTrackingData(e,{duration:t,distance:r,caloriesBurned:s})}recordEnduranceSession(e,t,r=null){return this.recordTrackingData(e,{duration:t,difficulty:r})}updateTrackingData(e,t,r){const s=this.getExerciseById(e);if(!s)throw new Error(`Exercise with id ${e} not found`);this.strategyFactory.getStrategy(s.type).updateTrackingData(s,t,r)}updateSet(e,t,r,s){return this.updateTrackingData(e,t,{reps:r,weight:s})}updateCardioSession(e,t,r,s,o){return this.updateTrackingData(e,t,{duration:r,distance:s,caloriesBurned:o})}updateEnduranceSession(e,t,r,s){return this.updateTrackingData(e,t,{duration:r,difficulty:s})}getTotalStatisticByType(e,t){return this.exercises.filter((t=>t.type===e)).reduce(((e,r)=>e+(this.strategyFactory.getStrategy(r.type).getStatistics(r)[t]||0)),0)}getTotalWeight(){return this.getTotalStatisticByType(i.STRENGTH,"totalWeight")}getTotalDistance(){return this.getTotalStatisticByType(i.CARDIO,"totalDistance")}getTotalDuration(){return this.getTotalStatisticByType(i.CARDIO,"totalDuration")}getTotalCalories(){return this.getTotalStatisticByType(i.CARDIO,"totalCalories")}getTotalEnduranceDuration(){return this.getTotalStatisticByType(i.ENDURANCE,"totalDuration")}getMaxEnduranceDuration(){const e=this.exercises.filter((e=>e.type===i.ENDURANCE)).map((e=>this.strategyFactory.getStrategy(e.type).getStatistics(e).maxDuration||0));return e.length?Math.max(...e):0}getTotalEnduranceIntensity(){return this.getTotalStatisticByType(i.ENDURANCE,"totalIntensity")}hasChangesFromPlan(){if(!this.plan)return!1;if(this.plan.exercises.length>this.exercises.length)return!0;for(const e of this.exercises){const t=this.plan.exercises.find((t=>t.id===e.id));if(!t)return!0;if(this.strategyFactory.getStrategy(e.type).hasChanges(e,t))return!0}return!1}updatePlanSets(){if(!this.plan)return!1;for(const e of this.exercises){const t=this.plan.exercises.find((t=>t.id===e.id));if(t){this.strategyFactory.getStrategy(e.type).updatePlanData(e,t)}}return!0}}class S{constructor(e,t,r){this.exerciseService=e,this.workoutPlanService=t,this.storageManager=r,this.workouts=this.storageManager.getWorkouts()||[],this._deserializeWorkouts()}_deserializeWorkouts(){this.workouts=this.workouts.map((e=>{let t=null;e.plan&&void 0!==e.plan.id&&(t=this.workoutPlanService.getWorkoutPlanById(e.plan.id));const r=new x(e.id,e.ownerId,new Date(e.date),t);return e.exercises&&e.exercises.length&&e.exercises.forEach((e=>{if(!r.getExerciseById(e.id)){const t=this.exerciseService.getExerciseById(e.id);t&&(r.addExercise(t),e.sets&&e.sets.length?e.sets.forEach((t=>{r.recordSet(e.id,t.reps,t.weight)})):e.sessions&&e.sessions.length&&("Cardio"===e.type?e.sessions.forEach((t=>{r.recordCardioSession(e.id,t.duration,t.distance,t.caloriesBurned)})):"Endurance"===e.type&&e.sessions.forEach((t=>{r.recordEnduranceSession(e.id,t.duration,t.difficulty)}))))}})),r}))}_saveWorkouts(){this.storageManager.saveWorkouts(this.workouts)}generateWorkoutId(){return this.workouts.length?Math.max(...this.workouts.map((e=>e.id)))+1:0}createWorkout(e,t=null,r){let s=null;if(void 0!==r&&(s=this.workoutPlanService.getWorkoutPlanById(r),!s))throw new Error(`План тренировки с ID ${r} не найден`);const o=this.generateWorkoutId(),i=new x(o,e,t||new Date,s);return this.workouts.push(i),this._saveWorkouts(),i}addExerciseToWorkout(e,t){const r=this.getWorkoutById(e),s=this.exerciseService.getExerciseById(t);if(!r)throw new Error(`Тренировка с ID ${e} не найдена`);if(!s)throw new Error(`Упражнение с ID ${t} не найдено`);return r.addExercise(s),this._saveWorkouts(),r}recordSetInWorkout(e,t,r,s){const o=this.getWorkoutById(e);if(!o)throw new Error(`Тренировка с ID ${e} не найдена`);o.recordSet(t,r,s),this._saveWorkouts()}updateSetInWorkout(e,t,r,s,o){const i=this.getWorkoutById(e);if(!i)throw new Error(`Тренировка с ID ${e} не найдена`);i.updateSet(t,r,s,o),this._saveWorkouts()}recordCardioSessionInWorkout(e,t,r,s,o=null){const i=this.getWorkoutById(e);if(!i)throw new Error(`Тренировка с ID ${e} не найдена`);i.recordCardioSession(t,r,s,o),this._saveWorkouts()}updateCardioSessionInWorkout(e,t,r,s,o,i){const a=this.getWorkoutById(e);if(!a)throw new Error(`Тренировка с ID ${e} не найдена`);a.updateCardioSession(t,r,s,o,i),this._saveWorkouts()}recordEnduranceSessionInWorkout(e,t,r,s=null){const o=this.getWorkoutById(e);if(!o)throw new Error(`Тренировка с ID ${e} не найдена`);o.recordEnduranceSession(t,r,s),this._saveWorkouts()}updateEnduranceSessionInWorkout(e,t,r,s,o){const i=this.getWorkoutById(e);if(!i)throw new Error(`Тренировка с ID ${e} не найдена`);i.updateEnduranceSession(t,r,s,o),this._saveWorkouts()}getWorkoutById(e){return this.workouts.find((t=>t.id===e))}getWorkoutsForUser(e){return this.workouts.filter((t=>t.ownerId===e))}getAllWorkouts(){return this.workouts}getTotalWeightForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getTotalWeight()}getTotalDistanceForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getTotalDistance()}getTotalDurationForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getTotalDuration()}getTotalEnduranceDurationForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getTotalEnduranceDuration()}getMaxEnduranceDurationForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getMaxEnduranceDuration()}getEnduranceTotalIntensityForWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.getTotalEnduranceIntensity()}hasChangesFromPlan(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);return t.hasChangesFromPlan()}updatePlanSetsInWorkout(e){const t=this.getWorkoutById(e);if(!t)throw new Error(`Тренировка с ID ${e} не найдена`);const r=t.updatePlanSets();return this._saveWorkouts(),r}}class D{constructor(e,t){this.userService=e,this.workoutService=t,this.strategyFactory=new k}getUserWeightProgress(e,t=null,r=null){const s=this.userService.getUserById(e);if(!s)throw new Error(`User with ID ${e} not found`);const o=s.weightHistory,i=t?new Date(t):null,a=r?new Date(r):null,n=o.filter((e=>{const t=e.date;return(!i||t>=i)&&(!a||t<=a)}));if(0===n.length)return{userWeightProgress:0,dateWeights:[]};return{userWeightProgress:n[n.length-1].weight-n[0].weight,dateWeights:n}}getWorkoutsByDate(e,t=null,r=null){const s=this.workoutService.getWorkoutsForUser(e),o=t?new Date(t):null,i=r?new Date(r):null;return s.filter((e=>{const t=e.date;return(!o||t>=o)&&(!i||t<=i)}))}getWorkoutProgress(e,t=null,r=null){const s=this.getWorkoutsByDate(e,t,r);if(0===s.length)return{totalWeightProgress:0,totalDistanceProgress:0,totalDurationProgress:0,workoutsByDate:[]};return{totalWeightProgress:s[s.length-1].getTotalWeight()-s[0].getTotalWeight(),totalDistanceProgress:s[s.length-1].getTotalDistance()-s[0].getTotalDistance(),totalDurationProgress:s[s.length-1].getTotalDuration()-s[0].getTotalDuration(),workoutsByDate:s.map((e=>({date:e.date,totalWeight:e.getTotalWeight(),totalDistance:e.getTotalDistance(),totalDuration:e.getTotalDuration()})))}}getExerciseProgress(e,t,r=null,s=null){const o=this.getWorkoutsByDate(e,r,s),i=[];for(const e of o){const r=e.exercises.find((e=>e.id===t));r&&i.push({date:e.date,exercise:r})}if(0===i.length)return{progress:[],message:"No exercise data found for the specified period"};const a=i[0].exercise;try{const e=this.strategyFactory.getStrategy(a.type),t=i.map((t=>({date:t.date,...e.getStatistics(t.exercise)})));return{...e.calculateProgress(i[0].exercise,i[i.length-1].exercise),progress:t}}catch(e){return console.error(`Error calculating progress: ${e.message}`),{progress:[],message:`Error calculating progress: ${e.message}`}}}getUserStatisticsSummary(e,t=null,r=null){const s=this.getUserWeightProgress(e,t,r),o=this.getWorkoutProgress(e,t,r),i=this.userService.getUserById(e),a=i?i.currentWeight:null;return{weightMetrics:{initialWeight:i&&i.weightHistory.length>0?i.weightHistory[0].weight:null,currentWeight:a,change:s.userWeightProgress,history:s.dateWeights},workoutMetrics:{totalWorkouts:o.workoutsByDate.length,totalWeightLifted:o.workoutsByDate.reduce(((e,t)=>e+t.totalWeight),0),totalDistanceCovered:o.workoutsByDate.reduce(((e,t)=>e+t.totalDistance),0),totalDurationSpent:o.workoutsByDate.reduce(((e,t)=>e+t.totalDuration),0),progress:o}}}}class f{constructor(e){this.storageKey=e}getData(){if("undefined"==typeof window)return null;const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):null}saveData(e){"undefined"!=typeof window&&localStorage.setItem(this.storageKey,JSON.stringify(e))}clearData(){"undefined"!=typeof window&&localStorage.removeItem(this.storageKey)}}class W{constructor(){this.userStorage=new f("workout-app-users"),this.exerciseStorage=new f("workout-app-exercises"),this.workoutPlanStorage=new f("workout-app-workout-plans"),this.workoutStorage=new f("workout-app-workouts"),this._initializeStorage()}_initializeStorage(){"undefined"!=typeof window&&(this.userStorage.getData()||this.userStorage.saveData([]),this.exerciseStorage.getData()||this.exerciseStorage.saveData([]),this.workoutPlanStorage.getData()||this.workoutPlanStorage.saveData([]),this.workoutStorage.getData()||this.workoutStorage.saveData([]))}getUsers(){return this.userStorage.getData()||[]}saveUsers(e){this.userStorage.saveData(e)}getExercises(){return this.exerciseStorage.getData()||[]}saveExercises(e){this.exerciseStorage.saveData(e)}getWorkoutPlans(){return this.workoutPlanStorage.getData()||[]}saveWorkoutPlans(e){this.workoutPlanStorage.saveData(e)}getWorkouts(){return this.workoutStorage.getData()||[]}saveWorkouts(e){this.workoutStorage.saveData(e)}clearAllData(){this.userStorage.clearData(),this.exerciseStorage.clearData(),this.workoutPlanStorage.clearData(),this.workoutStorage.clearData(),this._initializeStorage()}}class m{constructor(){this.storageManager=new W,this.userService=new t(this.storageManager),this.exerciseService=new g(this.storageManager),this.workoutPlanService=new E(this.exerciseService,this.storageManager),this.workoutService=new S(this.exerciseService,this.workoutPlanService,this.storageManager),this.statisticsService=new D(this.userService,this.workoutService)}showUsers(){console.log(this.userService.getAllUsers())}userReg(e,t,r,s,o){try{const i=this.userService.registerUser(e,t,r,s,o);return console.log(`Пользователь ${i.name} зарегестрирован`),i}catch(e){throw console.error(e.message),e}}userLogin(e,t){try{const r=this.userService.loginUser(e,t);return console.log(`Пользователь ${r.name} вошёл в систему`),r}catch(e){throw console.error(e.message),e}}updateWeight(e){try{this.userService.updateUserWeight(e),console.log(`Пользователь обновил вес на ${e} кг`)}catch(e){throw console.error(e.message),e}}updateProfile(e,t,r,s){try{this.userService.updateUserProfile(e,t,r,s),console.log("Пользователь обновил профиль")}catch(e){throw console.error(e.message),e}}showExercises(){console.log(this.exerciseService.getAllExercises())}createStrengthExercise(e,t,r,s,o,i){const a=this.exerciseService.createStrengthExercise(e,t,r,s,o,i);return console.log(`Упражнение ${a.name} добавлено`),a}createCardioExercise(e,t,r,s,o){const i=this.exerciseService.createCardioExercise(e,t,r,s,o);return console.log(`Кардио упражнение ${i.name} добавлено`),i}createEnduranceExercise(e,t,r,s,o){const i=this.exerciseService.createEnduranceExercise(e,t,r,s,o);return console.log(`Упражнение на выносливость ${i.name} добавлено`),i}createGenericExercise(e,t,r,s,o,i){const a=this.exerciseService.createGenericExercise(e,t,r,s,o,i);return console.log(`${e} упражнение ${a.name} добавлено`),a}removeExercise(e){this.exerciseService.removeExercise(e)}showWorkoutPlans(){console.log(this.workoutPlanService.getAllWorkoutPlans())}createWorkoutPlan(e,t){try{const r=this.userService.getCurrentUser().id,s=this.workoutPlanService.createWorkoutPlan(r,e,t);return console.log("Программа тренировок создана"),s}catch(e){throw console.error(e.message),e}}deleteWorkoutPlan(e){try{this.workoutPlanService.deleteWorkoutPlan(e)}catch(e){throw console.error(e.message),e}}addExerciseToWorkoutPlan(e,t){try{const r=this.exerciseService.getExerciseById(t),s=this.workoutPlanService.addExerciseToWorkoutPlan(e,t);console.log(`Упражнение ${r.name} добавлено в программу тренировок ${s.name}`)}catch(e){throw console.error(e.message),e}}removeExerciseFromWorkoutPlan(e,t){try{return this.workoutPlanService.removeExerciseFromWorkoutPlan(e,t)}catch(e){throw console.error(e.message),e}}addSetToExerciseInWorkoutPlan(e,t,r,s){try{this.workoutPlanService.addSetToExerciseInWorkoutPlan(e,t,r,s)}catch(e){throw console.error(e.message),e}}addSessionToExerciseInWorkoutPlan(e,t,r,s,o=null){try{const i=this.workoutPlanService.addSessionToExerciseInWorkoutPlan(e,t,r,s,o);console.log(`Кардио сессия добавлена в упражнение ${i.name}`)}catch(e){throw console.error(e.message),e}}addEnduranceSessionToExerciseInWorkoutPlan(e,t,r,s=null){try{const o=this.workoutPlanService.addEnduranceSessionToExerciseInWorkoutPlan(e,t,r,s);console.log(`Сессия выносливости добавлена в упражнение ${o.name}`)}catch(e){throw console.error(e.message),e}}getWorkoutPlanExercises(e){try{const t=this.workoutPlanService.getWorkoutPlanById(e);console.log(t.exercises)}catch(e){throw console.error(e.message),e}}showWorkouts(){console.log(this.workoutService.getAllWorkouts())}createWorkout(e=null,t){try{const r=this.userService.getCurrentUser().id,s=this.workoutService.createWorkout(r,e,t);return console.log("Тренировка создана"),s}catch(e){throw console.error(e.message),e}}addExerciseToWorkout(e,t){try{const r=this.workoutService.addExerciseToWorkout(e,t),s=this.exerciseService.getExerciseById(t);return console.log(`Exercise ${s.name} added to workout`),r}catch(e){throw console.error(e.message),e}}recordSetInWorkout(e,t,r,s){try{this.workoutService.recordSetInWorkout(e,t,r,s),console.log(`Записан сет со значениями ${r} повторений ${s} кг`)}catch(e){throw console.error(e.message),e}}updateSetInWorkout(e,t,r,s,o){try{this.workoutService.updateSetInWorkout(e,t,r,s,o),console.log(`Сет обновлён со значениями ${s} подходов ${o} кг`)}catch(e){throw console.error(e.message),e}}recordCardioSessionInWorkout(e,t,r,s,o=null){try{this.workoutService.recordCardioSessionInWorkout(e,t,r,s,o),console.log(`Записана кардио сессия: ${r} минут, ${s} км`)}catch(e){throw console.error(e.message),e}}updateCardioSessionInWorkout(e,t,r,s,o,i){try{this.workoutService.updateCardioSessionInWorkout(e,t,r,s,o,i),console.log(`Кардио сессия обновлена: ${s} минут, ${o} км`)}catch(e){throw console.error(e.message),e}}recordEnduranceSessionInWorkout(e,t,r,s=null){try{this.workoutService.recordEnduranceSessionInWorkout(e,t,r,s),console.log(`Записана сессия выносливости: ${r} секунд, сложность: ${s||"не указана"}`)}catch(e){throw console.error(e.message),e}}updateEnduranceSessionInWorkout(e,t,r,s,o){try{this.workoutService.updateEnduranceSessionInWorkout(e,t,r,s,o),console.log(`Сессия выносливости обновлена: ${s} секунд, сложность: ${o||"не указана"}`)}catch(e){throw console.error(e.message),e}}showWorkout(e){try{const t=this.workoutService.getWorkoutById(e);console.log(t)}catch(e){throw console.error(e.message),e}}hasChangesFromPlan(e){try{return this.workoutService.hasChangesFromPlan(e)}catch(e){throw console.error(e.message),e}}updatePlanSetsInWorkout(e){try{return this.workoutService.updatePlanSetsInWorkout(e)}catch(e){throw console.error(e.message),e}}getTotalWeightForWorkout(e){try{const t=this.workoutService.getTotalWeightForWorkout(e);return console.log("Общий вес за тренировку: "+t),t}catch(e){throw console.error(e.message),e}}getTotalDistanceForWorkout(e){try{const t=this.workoutService.getTotalDistanceForWorkout(e);return console.log("Общая дистанция за тренировку: "+t+" км"),t}catch(e){throw console.error(e.message),e}}getTotalDurationForWorkout(e){try{const t=this.workoutService.getTotalDurationForWorkout(e);return console.log("Общая длительность кардио за тренировку: "+t+" минут"),t}catch(e){throw console.error(e.message),e}}getTotalEnduranceDurationForWorkout(e){try{const t=this.workoutService.getTotalEnduranceDurationForWorkout(e);return console.log("Общее время упражнений на выносливость за тренировку: "+t+" секунд"),t}catch(e){throw console.error(e.message),e}}getMaxEnduranceDurationForWorkout(e){try{const t=this.workoutService.getMaxEnduranceDurationForWorkout(e);return console.log("Максимальная продолжительность упражнения на выносливость: "+t+" секунд"),t}catch(e){throw console.error(e.message),e}}getEnduranceTotalIntensityForWorkout(e){try{const t=this.workoutService.getEnduranceTotalIntensityForWorkout(e);return console.log("Общая интенсивность упражнений на выносливость: "+t),t}catch(e){throw console.error(e.message),e}}getUserWeightProgress(e=null,t=null){try{const r=this.userService.getCurrentUser(),s=this.statisticsService.getUserWeightProgress(r.id,e,t);return console.log(s),s}catch(e){throw console.error(e.message),e}}getWorkoutProgress(e=null,t=null){try{const r=this.userService.getCurrentUser(),s=this.statisticsService.getWorkoutProgress(r.id,e,t);return console.log(s),s}catch(e){throw console.error(e.message),e}}getExerciseProgress(e,t=null,r=null){try{const s=this.userService.getCurrentUser(),o=this.statisticsService.getExerciseProgress(s.id,e,t,r);return console.log(o),o}catch(e){throw console.error(e.message),e}}getCardioProgress(e,t=null,r=null){try{const s=this.exerciseService.getExerciseById(e);if(!s||s.type!==i.CARDIO)return void console.log("Кардио упражнение не найдено");const o=this.userService.getCurrentUser(),a=this.statisticsService.getExerciseProgress(o.id,e,t,r);return console.log("Прогресс кардио упражнения:",a),a}catch(e){throw console.error(e.message),e}}getEnduranceProgress(e,t=null,r=null){try{const s=this.exerciseService.getExerciseById(e);if(!s||s.type!==i.ENDURANCE)return void console.log("Упражнение на выносливость не найдено");const o=this.userService.getCurrentUser(),a=this.statisticsService.getExerciseProgress(o.id,e,t,r);return console.log("Прогресс упражнения на выносливость:",a),a}catch(e){throw console.error(e.message),e}}}exports.CardioExercise=o,exports.EnduranceExercise=n,exports.Exercise=r,exports.ExerciseFactory=h,exports.ExerciseService=g,exports.ExerciseType=i,exports.LocalStorageManager=W,exports.StatisticsService=D,exports.StrengthExercise=u,exports.User=e,exports.UserService=t,exports.Workout=x,exports.WorkoutPlan=p,exports.WorkoutPlanService=E,exports.WorkoutService=S,exports.createWorkoutPlanner=()=>new m;
//# sourceMappingURL=index.js.map
